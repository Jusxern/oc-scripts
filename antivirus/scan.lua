--[[

Version: 0.2.2

    /$$$$$  /$$$$$$  /$$    /$$
   |__  $$ /$$__  $$| $$   | $$
      | $$| $$  \ $$| $$   | $$
      | $$| $$$$$$$$|  $$ / $$/
 /$$  | $$| $$__  $$ \  $$ $$/ 
| $$  | $$| $$  | $$  \  $$$/  
|  $$$$$$/| $$  | $$   \  $/   
 \______/ |__/  |__/    \_/    
                               
JustAntiVirus. By jusxern

added filters - 11.06
optimized some important functions - 25.07

]]
local a=require("shell")local b=require('io')local c=require('process')local d=require('pipe')local e,f=a.parse(...)local function g()b.write("Usage: scan [options] <filename1> ".."\n-n      will only print scan results\n--help  display this help and exit\nIcons meaning:\n‚è≥ - loading/processing.\n‚úÖ - successfully passed a check.\n‚ùó - warning this code is suspicious.\nüõë  - code most likely contains virus.\nüîê - running mathematical processes")end;if#e==0 or f.help then g()return 1 end;local h=e[1]local i=b.open(h)local j=i:read("*a")local k={['load']='‚è≥',['warn']='‚ùó',['stop']='üõë',['suc']='‚úÖ',['brut']='üîê',['tab']='        '}local l={['/lib/core']={k.warn..'manipulating core',2},['/lib/core/boot.lua']={k.stop..'manipulating the boot.lua',3},['/init.lua']={k.stop..'manipulating the Init.lua',3},['loadstring']={k.warn..'may load suspicious code',2},['load()']={k.warn..'may load suspicious code',2},['eeprom.set']={k.stop..'manipulating eeprom data',3},['virus']={k.warn..'virus mentioned in this codeüòÆüò°üò°üò°'},['rm% %-rfv% /usr']={k.stop..'deleting system directory /usr',3},['rm% %-rvf% /usr']={k.stop..'deleting system directory /usr',3},['rm% %-frv% /usr']={k.stop..'deleting system directory /usr',3},['rm% %-fvr% /usr']={k.stop..'deleting system directory /usr',3},['rm% %-vrf% /usr']={k.stop..'deleting system directory /usr',3},['rm% %-vfr% /usr']={k.stop..'deleting system directory /usr',3},['rm% %-rfv% /boot']={k.stop..'deleting system directory /boot',3},['rm% %-rvf% /boot']={k.stop..'deleting system directory /boot',3},['rm% %-frv% /boot']={k.stop..'deleting system directory /boot',3},['rm% %-fvr% /boot']={k.stop..'deleting system directory /boot',3},['rm% %-vrf% /boot']={k.stop..'deleting system directory /boot',3},['rm% %-vfr% /boot']={k.stop..'deleting system directory /boot',3},['rm% %-rfv% /dev']={k.stop..'deleting system directory /dev',3},['rm% %-rvf% /dev']={k.stop..'deleting system directory /dev',3},['rm% %-frv% /dev']={k.stop..'deleting system directory /dev',3},['rm% %-fvr% /dev']={k.stop..'deleting system directory /dev',3},['rm% %-vrf% /dev']={k.stop..'deleting system directory /dev',3},['rm% %-vfr% /dev']={k.stop..'deleting system directory /dev',3},['rm% %-rfv% /etc']={k.stop..'deleting system directory /etc',3},['rm% %-rvf% /etc']={k.stop..'deleting system directory /etc',3},['rm% %-frv% /etc']={k.stop..'deleting system directory /etc',3},['rm% %-fvr% /etc']={k.stop..'deleting system directory /etc',3},['rm% %-vrf% /etc']={k.stop..'deleting system directory /etc',3},['rm% %-vfr% /etc']={k.stop..'deleting system directory /etc',3},['rm% %-rfv% /home']={k.stop..'deleting system directory /home',3},['rm% %-rvf% /home']={k.stop..'deleting system directory /home',3},['rm% %-frv% /home']={k.stop..'deleting system directory /home',3},['rm% %-fvr% /home']={k.stop..'deleting system directory /home',3},['rm% %-vrf% /home']={k.stop..'deleting system directory /home',3},['rm% %-vfr% /home']={k.stop..'deleting system directory /home',3},['rm% %-rfv% /tmp']={k.stop..'deleting system directory /tmp',3},['rm% %-rvf% /tmp']={k.stop..'deleting system directory /tmp',3},['rm% %-frv% /tmp']={k.stop..'deleting system directory /tmp',3},['rm% %-fvr% /tmp']={k.stop..'deleting system directory /tmp',3},['rm% %-vrf% /tmp']={k.stop..'deleting system directory /tmp',3},['rm% %-vfr% /tmp']={k.stop..'deleting system directory /tmp',3},['rm% %-rfv% /mnt']={k.stop..'deleting system directory /mnt',3},['rm% %-rvf% /mnt']={k.stop..'deleting system directory /mnt',3},['rm% %-frv% /mnt']={k.stop..'deleting system directory /mnt',3},['rm% %-fvr% /mnt']={k.stop..'deleting system directory /mnt',3},['rm% %-vrf% /mnt']={k.stop..'deleting system directory /mnt',3},['rm% %-vfr% /mnt']={k.stop..'deleting system directory /mnt',3},['rm% %-rfv% /bin']={k.stop..'deleting system directory /bin',3},['rm% %-rvf% /bin']={k.stop..'deleting system directory /bin',3},['rm% %-frv% /bin']={k.stop..'deleting system directory /bin',3},['rm% %-fvr% /bin']={k.stop..'deleting system directory /bin',3},['rm% %-vrf% /bin']={k.stop..'deleting system directory /bin',3},['rm% %-vfr% /bin']={k.stop..'deleting system directory /bin',3},['rm% %-r %-f %-v%  /usr']={k.stop..'deleting system directory /usr',3},['rm% %-r %-v %-f%  /usr']={k.stop..'deleting system directory /usr',3},['rm% %-f %-r %-v%  /usr']={k.stop..'deleting system directory /usr',3},['rm% %-f %-v %-r%  /usr']={k.stop..'deleting system directory /usr',3},['rm% %-v %-r %-f%  /usr']={k.stop..'deleting system directory /usr',3},['rm% %-v %-f %-r%  /usr']={k.stop..'deleting system directory /usr',3},['rm% %-r %-f %-v%  /boot']={k.stop..'deleting system directory /boot',3},['rm% %-r %-v %-f%  /boot']={k.stop..'deleting system directory /boot',3},['rm% %-f %-r %-v%  /boot']={k.stop..'deleting system directory /boot',3},['rm% %-f %-v %-r%  /boot']={k.stop..'deleting system directory /boot',3},['rm% %-v %-r %-f%  /boot']={k.stop..'deleting system directory /boot',3},['rm% %-v %-f %-r%  /boot']={k.stop..'deleting system directory /boot',3},['rm% %-r %-f %-v%  /dev']={k.stop..'deleting system directory /dev',3},['rm% %-r %-v %-f%  /dev']={k.stop..'deleting system directory /dev',3},['rm% %-f %-r %-v%  /dev']={k.stop..'deleting system directory /dev',3},['rm% %-f %-v %-r%  /dev']={k.stop..'deleting system directory /dev',3},['rm% %-v %-r %-f%  /dev']={k.stop..'deleting system directory /dev',3},['rm% %-v %-f %-r%  /dev']={k.stop..'deleting system directory /dev',3},['rm% %-r %-f %-v%  /etc']={k.stop..'deleting system directory /etc',3},['rm% %-r %-v %-f%  /etc']={k.stop..'deleting system directory /etc',3},['rm% %-f %-r %-v%  /etc']={k.stop..'deleting system directory /etc',3},['rm% %-f %-v %-r%  /etc']={k.stop..'deleting system directory /etc',3},['rm% %-v %-r %-f%  /etc']={k.stop..'deleting system directory /etc',3},['rm% %-v %-f %-r%  /etc']={k.stop..'deleting system directory /etc',3},['rm% %-r %-f %-v%  /home']={k.stop..'deleting system directory /home',3},['rm% %-r %-v %-f%  /home']={k.stop..'deleting system directory /home',3},['rm% %-f %-r %-v%  /home']={k.stop..'deleting system directory /home',3},['rm% %-f %-v %-r%  /home']={k.stop..'deleting system directory /home',3},['rm% %-v %-r %-f%  /home']={k.stop..'deleting system directory /home',3},['rm% %-v %-f %-r%  /home']={k.stop..'deleting system directory /home',3},['rm% %-r %-f %-v%  /tmp']={k.stop..'deleting system directory /tmp',3},['rm% %-r %-v %-f%  /tmp']={k.stop..'deleting system directory /tmp',3},['rm% %-f %-r %-v%  /tmp']={k.stop..'deleting system directory /tmp',3},['rm% %-f %-v %-r%  /tmp']={k.stop..'deleting system directory /tmp',3},['rm% %-v %-r %-f%  /tmp']={k.stop..'deleting system directory /tmp',3},['rm% %-v %-f %-r%  /tmp']={k.stop..'deleting system directory /tmp',3},['rm% %-r %-f %-v%  /mnt']={k.stop..'deleting system directory /mnt',3},['rm% %-r %-v %-f%  /mnt']={k.stop..'deleting system directory /mnt',3},['rm% %-f %-r %-v%  /mnt']={k.stop..'deleting system directory /mnt',3},['rm% %-f %-v %-r%  /mnt']={k.stop..'deleting system directory /mnt',3},['rm% %-v %-r %-f%  /mnt']={k.stop..'deleting system directory /mnt',3},['rm% %-v %-f %-r%  /mnt']={k.stop..'deleting system directory /mnt',3},['rm% %-r %-f %-v%  /bin']={k.stop..'deleting system directory /bin',3},['rm% %-r %-v %-f%  /bin']={k.stop..'deleting system directory /bin',3},['rm% %-f %-r %-v%  /bin']={k.stop..'deleting system directory /bin',3},['rm% %-f %-v %-r%  /bin']={k.stop..'deleting system directory /bin',3},['rm% %-v %-r %-f%  /bin']={k.stop..'deleting system directory /bin',3},['rm% %-v %-f %-r%  /bin']={k.stop..'deleting system directory /bin',3},['rm% -rfv  /']={k.warn..'deleting directory with root perms',2},['rm% -rvf  /']={k.warn..'deleting directory with root perms',2},['rm% -frv  /']={k.warn..'deleting directory with root perms',2},['rm% -fvr  /']={k.warn..'deleting directory with root perms',2},['rm% -vrf  /']={k.warn..'deleting directory with root perms',2},['rm% -vfr  /']={k.warn..'deleting directory with root perms',2},['rm% -rfv  /.']={k.warn..'deleting directory with root perms',2},['rm% -rvf  /.']={k.warn..'deleting directory with root perms',2},['rm% -frv  /.']={k.warn..'deleting directory with root perms',2},['rm% -fvr  /.']={k.warn..'deleting directory with root perms',2},['rm% -vrf  /.']={k.warn..'deleting directory with root perms',2},['rm% -vfr  /.']={k.warn..'deleting directory with root perms',2},['rm% -r -f -v  /']={k.warn..'deleting directory with root perms',2},['rm% -r -v -f  /']={k.warn..'deleting directory with root perms',2},['rm% -f -r -v  /']={k.warn..'deleting directory with root perms',2},['rm% -f -v -r  /']={k.warn..'deleting directory with root perms',2},['rm% -v -r -f  /']={k.warn..'deleting directory with root perms',2},['rm% -v -f -r  /']={k.warn..'deleting directory with root perms',2},['rm% -r -f -v  /.']={k.warn..'deleting directory with root perms',2},['rm% -r -v -f  /.']={k.warn..'deleting directory with root perms',2},['rm% -f -r -v  /.']={k.warn..'deleting directory with root perms',2},['rm% -f -v -r  /.']={k.warn..'deleting directory with root perms',2},['rm% -v -r -f  /.']={k.warn..'deleting directory with root perms',2},['rm% -v -f -r  /.']={k.warn..'deleting directory with root perms',2},['^Bbytecode']={k.stop..'loads obfuscated code via bytecode obfuscating!\n'..k.tab..k.stop..'try to deobfuscate it and analyze!',3},['^Vnobf']={k.suc..'variables are not obfuscated',1},['^Vobf']={k.warn..'variables are obfuscated!',2},['^Fnobf']={k.suc..'functions are not obfuscated',1},['^Fobf']={k.stop..'functions are obfuscated!',3}}local m={}local function n(o)local p={}local q=0;for r in o:gmatch('[^\r\n]+')do table.insert(p,r)end;return p end;local function s(o)local p={}local q=0;for t,u in pairs(l)do q=q+1;local v,w=pcall(function()if o:match(t)then p[t]=o elseif q==#l-1 then return false end end)if w then print(o,t,u,w,'\n Finished capture')break end end;return p end;function check()function extract_load_bytecode(x)x=x:gsub("%-%-.*","")local y={}for z in x:gmatch("%Wload%s*%((.-)%)")do table.insert(y,z)end;return#y>0 and y or nil end;for A,B in pairs(n(j))do local C=s(B)for t,o in pairs(C)do if t=="load()"then if extract_load_bytecode(o)then print(A..': '..o..' -> '..l[t][1])table.insert(m,{A,t})end else print(A..': '..o..' -> '..l[t][1])table.insert(m,{A,t})end end end;print(string.rep('\n',3))print(k.load..'Cheking for obfuscated variables...')ObfuscatedVar={}local q=0;for A,B in pairs(n(j))do if B:match('local')then for D=0,30 do if B:match('local v'..D)then ObfuscatedVar[B:match('v'..D)]=B end end end end;local E=false;for A,F in pairs(ObfuscatedVar)do if A~=0 and not E then print(k.warn..'Script variables are obfuscated!')E=true;table.insert(m,{0,'^Vobf'})end end;if E==false then print(k.suc..'script variables are not obfuscated')table.insert(m,{0,'^Vnobf'})end;print('\n'..k.load..'Cheking for obfuscated functions...')local v=false;local q=0;for A,B in pairs(n(j))do for A=0,80 do if B:match('function v'..A)then ObfuscatedVar[B:match('v'..A)]=B;v=true end end end;if v==false then print(k.suc..'script functions are not obfuscated')table.insert(m,{0,'^Fnobf'})else print(k.stop..'script functions are obfuscated!')table.insert(m,{0,'^Fobf'})end;local v=0;print('\n'..k.load..'Checking for loadstring...')for A,B in pairs(m)do if B[2]=='loadstring'or B[2]=='load()'then print(k.warn..'found loadstring')v=1;local G=n(j)local j=G[B[1]]local H='\0\0'local I=true;if j:match("\\")then os.sleep(0)require('thread').create(function()print(k.brut..'bruteforcing bytecode may occur lag!')while I do H='\\'..tostring(math.floor(math.random(1,300)+0.5))..'\\'..tostring(math.floor(math.random(1,300)+0.5))if j:match(H)~=nil then I=false;print(k.suc..'Processing success, key:',H)v=2;table.insert(m,{B[1],'^Bbytecode'})end end end)end end end;local J={k.suc..'no loadstrings been found',k.warn..'loadstrings were found',k.stop..'bytecode loadstring found!'}print(J[v])print(string.rep("\n",2))for A,F in pairs(m)do end;print('Scan results:')print('More information above in the log ‚¨Ü\n')for A,K in pairs(m)do local L=n(j)os.sleep(0)print('ln: '..K[1],l[K[2]][1],A)end end;check()b.write('Run script? [y/N]\n')local M=b.read()if M=='y'or M=='Y'then loadfile(h)()return 0 end;print("Returning to shell.\n")return 0
